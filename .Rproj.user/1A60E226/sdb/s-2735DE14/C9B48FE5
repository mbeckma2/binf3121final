{
    "collab_server" : "",
    "contents" : "---\ntitle: \"DNA Microarrays Part 2\"\nauthor: \"Jennifer Daly\"\ndate: \"April 17, 2017\"\noutput: html_document\n---\n*Continuing from part 1, where I downloaded and organized data from an experiment conducted on Arabidopsis Thaliana, the experiment attempted to identify genes that operate \"downhill\" from the ARR10 and ARR12 genes. To do this, the group created a mutant plant who did not have these genes, and compared the additional genes expressed when treated with a substance containing cytokinin, a growth hormone, with the wild type plants. *\n\nFunctions called in part 1 to build data:\n```{r, message=FALSE, warning=F}\n#Required libraries\nlibrary(affy)\nlibrary(limma)\nlibrary(RSQLite)\n#Import data from sources\npd = read.AnnotatedDataFrame(\"samples.txt\",header=TRUE,sep=\",\",row.names=1) #A class 4 object; accessed with @\nmydata = ReadAffy(filenames=pd$filename,phenoData=pd,verbose=TRUE)\nsampleNames(mydata)=row.names(pData(pd))\n#Call functions to organize data\neset = rma(mydata)\nexpression_data = exprs(eset)\n```\n\nPart 2 of DNA microarray analysis is to use limma to find differently expressed genes. All genes I downloaded and organized in part 1 will be catagorized in three groups:\n\nGroup A: Genes that are differently expressed betweeen Wild Type treated and untreated. \n\nGroup B: Genes differently expressed between Mutated treated and untreated.\n\nGroup C: Genes that responded differently depending on if the plant was Wild Type or Mutant. \n\n**Create a design matrix:** Rows correspond to microarray samples and the design matrix columns contain 0s and 1s to indicate group affiliation. \n\n1) Create factor objects that represent the different experimental groups\n```{r}\nTS = paste(pd$genotype,pd$treatment,sep=\".\") #Combines two vectors using \".\" as a separator\nTS = factor(TS, levels = c(\"WT.U\", \"WT.S\", \"Mu.U\", \"Mu.S\")) \n```\n\n2) Create the design matrix\n```{r}\nexp_design = model.matrix(~ 0 + TS) #Create table\ncolnames(exp_design) = levels(TS) #Create column names for table\nexp_design #Display the table\n```\n\n**Fit a linear model to the data: ** lmFit produces a fitted model object of class MArrayLM containing coefficients, standard errors and residual standard errors for each gene.\n```{r}\nfit = lmFit(eset,exp_design)\n```\n\nHelpful commands to traverse the new 'fit' object: \n```{r}\n#To get a matrix of the log-transformed average expression values for each probe set:\n#averages = fit$coefficients \n#Log2 fold-change (compared values between groups) for the first probe set:\n#fit$coefficients[1,1]-fit$coefficients[1,2] \n```\n\n**Create a contrasts matrix:** Identify genes that are differently expressed between groups.\n```{r}\ncont.matrix= makeContrasts( \n    WT.SvU = WT.S - WT.U, # minus means: compare these groups \n    Mu.SvU = Mu.S - Mu.U, \n    Diff = (Mu.S - Mu.U) - (WT.S - WT.U), # compare the difference of differences \n    levels = exp_design) # provides the info needed to know what WT.S, etc means \nfit2 = contrasts.fit(fit,cont.matrix) \nfit2 = eBayes(fit2) # allows variance borrowing; estimates variance for individual genes using all of the genes.  \n```\n\nVisualize the results:\n```{r}\nresult = decideTests(fit2,p.value=0.01) \nvennDiagram(result) \n```\n\nKey:\nWT.SvU = Group A, difference in how genes were expressed in Wild Type plants due to treatment.\n\nMT.SvU = Group B, difference in how genes were expressed in Mutant type plants due to treatment. \n\nBoth (39) = There is a difference in how these genes are expressed in both plants. \n\nDiff = Group C. These genes respond differently to cytokinin depending on the gene type. \n\nQUESTION 1: How many probesets were differentially regulated in at least one group?  *A total of 708  genes*\n\n**Retrieve gene annotations:** Used to assosciate gene info (name + description) to the probe IDs.\n```{r}\nf=\"ftp://ftp.arabidopsis.org/Microarrays/Affymetrix/affy_ATH1_array_elements-2010-12-20.txt\" \nannots = read.delim(f, na.strings = \"\", fill=TRUE, header=T, sep=\"\\t\") \nannots=annots[,c(1,5,6)] #Save selected (columns 1,5,6) info in annots table\n```\n\n\n**Select top genes from each comparison:** topTable presents a list of the genes most likely to be differentially expressed for a given contrast.\n```{r}\nN=dim(eset)[1] \ntop.WT.SvU = topTable(fit2,coef=1,number=N,p.value=0.01) \ntop.Mu.SvU = topTable(fit2,coef=2,number=N,p.value=0.01) \ntop.Diff = topTable(fit2,coef=3,number=N,p.value=0.01) \n```\n\n**Merge annotations with top lists:** Combine the two tables of data using row names. \n```{r}\nrow.names(annots)=annots$array_element_name \ntop.Diff.merged=merge(annots,top.Diff,by=\"row.names\") \ntop.Mu.SvU.merged=merge(annots,top.Mu.SvU,by=\"row.names\") \ntop.WT.SvU.merged=merge(annots,top.WT.SvU,by=\"row.names\") \n```\n\n**Count and examine differently expressed genes:** Due to possible mismatches between the annotations and the probe sets, some genes may be counted twice. I can use unique and intersect functions to count genes by their annotation name instead of the prob set, which there may be multiples of. \n```{r}\ngenes.Diff = unique(top.Diff.merged$locus)\ngenes.WT.SvU = unique(top.WT.SvU.merged$locus)\ngenes.Mu.SvU = unique(top.Mu.SvU.merged$locus)\nintersection = intersect(genes.WT.SvU,genes.Mu.SvU)\n```\n\n**Summarize results:**\n\nQUESTION 2: How many genes were in Group A? *The genes that were differentially expressed in wt treated vs untreated: * `r length(unique(top.WT.SvU.merged$locus))`\n\nQUESTION 3: How many genes were in B?  *The genes that were differentially expressed in mutant treated vs untreated: * `r length(unique(top.Mu.SvU.merged$locus))`\n\nQUESTION 4: How many genes were both Group A and Group B? *Genes differently expressed between treated and untreated for both plant types: *  `r length(intersect(genes.WT.SvU,genes.Mu.SvU))`\n\nQUESTION 5: How many genes were in Group C? *The genes that respond differently depending on plant type: * `r length(unique(top.Diff.merged$locus))`\n\nQUESTION 6: \nWe expect that the wildtype (WT) plants can exhibit a more extreme response to cytokinin than the mutant plants. Does your data support this idea? To answer this question, look at the logFC columns in your results data frames. This column reports the log fold change between the compared groups. Larger magnitude logFC numbers indicate that the geneâ€™s response to cytokinin was larger. Hint: Use plots to explain your result.  \n\n*The below plots show genes by number (their place in the matrix) and corresponding LogFC value. The points show an obvious separation because of the combination of treated and untreated in each plot. Both plots have genes that are differently expressed, but the WT plot contains over 600 genes while the Mu plot contains under 40 total. The difference in the number of total expressed genes is what I was looking for to measure an extreme response to cytokinin. Wild Type has a much more extreme response to cytokinin*\n```{r}\nplot(top.WT.SvU$logFC,xlab=\"Gene (index number)\",ylab=\"LogFC\") #Group A\nplot(top.Mu.SvU$logFC,xlab=\"Gene (index number)\",ylab=\"LogFC\") #Group B\n```\n\nQUESTION 7: \nThe analysis from QUESTION 6 can only consider genes where we rejected the null hypothesis for mutant and wildtype comparisons, where H0 in each case was that cytokinin has no effect on mean gene expression for an individual gene. Thus, QUESTION 6 only considers genes that were differentially expressed in both mutant and wildtype. The \"topDiff\" data frame contains genes where we can reject a more interesting null hypothesis, which is that the mean differences due to the cytokinin treatment is the same in mutant and wildtype. Genes where we can reject this hypothesis are genes that depend on ARR7 and ARR12 to respond to cytokinin.  Answer: Which genes were in Group C and what were their functions? \n\n*The variable genes.Diff matches the three genes in group C. These genes are: AT4G15690 - Glutaredoxin family protein , AT2G40670 - Response regulator (ARR16) , and AT2G30540 - Glutaredoxin family protein. *\n\nBONUS POINTS - QUESTION 8: How did your results compare to what was reported in the paper? How did the authors analyze their data. Did they obtain similar results?  \n\n*After a review of this paper, It doesn't seem like we got the same results. In the paper, they state for roots specifically, \"The levels of induction of ARR15 and ARR16 were more severely attenuated in the arr10/12 roots, as compared with other cases, i.e. ARR5, ARR6 and ARR7.\" I think this means that instead of my three genes that I found in group C, they found these two.* \n[Referenced Journal](https://academic.oup.com/pcp/article-lookup/doi/10.1093/pcp/pcl040#41823985)\n\n**Write the data to a file: **\n```{r}\nwrite.table(top.Diff,file='top.Diff.txt',row.names=FALSE,sep='\\t') \nwrite.table(top.WT.SvU,file='top.WT.SvsU.txt',row.names=FALSE,sep='\\t')\nwrite.table(top.Mu.SvU,file='top.Mt.SvsU.txt',row.names=FALSE,sep='\\t')\n```\n",
    "created" : 1493057677498.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3263873561",
    "id" : "C9B48FE5",
    "lastKnownWriteTime" : 1492876993,
    "last_content_update" : 1492876993,
    "path" : "~/Desktop/UNCC_Spring_2017/BINF 3121 Biostat/dna_microarrrays2/dna_microarrays2.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}